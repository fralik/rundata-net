!function(){"use strict";const e=[{schemaName:"signature_text",text:{en:"Inscription"}},{schemaName:"full_address",text:{en:"Any location"}},{schemaName:"found_location",text:{en:"Found location"}},{schemaName:"parish",text:{en:"Parish"}},{schemaName:"district",text:{en:"District"}},{schemaName:"municipality",text:{en:"Municipality"}},{schemaName:"current_location",text:{en:"Current location"}},{schemaName:"original_site",text:{en:"Original site"}},{schemaName:"parish_code",text:{en:"Parish code"}},{schemaName:"rune_type",text:{en:"Rune type"}},{schemaName:"dating",text:{en:"Dating"}},{schemaName:"year_from",text:{en:"Year (from)"}},{schemaName:"year_to",text:{en:"Year (to)"}},{schemaName:"style",text:{en:"Style"}},{schemaName:"carver",text:{en:"Carver"}},{schemaName:"material",text:{en:"Material"}},{schemaName:"material_type",text:{en:"Material type"}},{schemaName:"objectInfo",text:{en:"Object information"}},{schemaName:"reference",text:{en:"References"}},{schemaName:"additional",text:{en:"Other information"}},{schemaName:"normalisation_norse",text:{en:"Normalization to Old West Norse"},css:"normalization",highlight:!0},{schemaName:"normalisation_scandinavian",text:{en:"Normalisation to Old Scandinavian"},css:"normalization",highlight:!0},{schemaName:"english_translation",text:{en:"Translation to English"}},{schemaName:"swedish_translation",text:{en:"Translation to Swedish"}},{schemaName:"transliteration",text:{en:"Transliterated runic text"},css:"transliteration",highlight:!0},{schemaName:"num_crosses",text:{en:"Number of crosses"}},{schemaName:"cross_form",text:{en:"Cross form"}},{schemaName:"crosses",text:{en:"Cross"}},{schemaName:"images",text:{en:"Images"}}],t={"U 166":[3,7],"Sm 1":[24,28],"U 637":[10,12],"U 1036":[14,16],"M 11":[16,35],"G 280":[5,7],"GR 56":[8],"N KJ72":[22],"N B625":[69],"N B311":[4],"N B265":[25],"N B259":[1],"N B255":[20],"N B27":[3],"N A197":[3],"N A5":[1],"N A144":[1],"N 603":[5],"N 362":[2],"N 208":[8],"N 171":[13],"N 124":[2],"N 114":[3],"N 26":[8],"N 19":[12],"DR NOR2004;7":[18],"DR NOR1999;21":[47],"G 306":[3],"G 129":[11],"G 119":[24],"Gs 8":[7],"Vs 27":[10],"Vs 22":[6],"Vs 3":[15],"U THS10;58":[15],"U NOR1998;25":[19],"U Fv1976;104":[3],"U Fv1953;263":[18],"U Fv1948;168":[16],"U 1168":[6],"U 1162":[11],"U 1158":[10],"U 1132":[13],"U 1111":[11],"U 1097":[3],"U 1060":[5],"U 1042":[10],"U 1005":[12],"U 968":[3],"U 952":[16],"U 917":[3],"U 896":[10],"U 805":[40],"U 662":[1],"U 618":[12],"U 545":[24],"U 459":[11],"U 423":[11],"U 351":[14],"Vg 219":[13],"Vg 67":[25],"Sö Fv1986;218":[8],"Sö 344":[3],"Sö 320":[5],"Sö 256":[10],"Sö 205":[3],"Sö 130":[20],"Sö 109":[13],"Sö 105":[5],"Sö 82":[9],"Sö 46":[19],"Sö 21":[6],"Ög 180":[4]},n={"IS IR;166":[12],"N 157":[4],"DR NOR2002;7":[9],"G 325":[8],"Nä 20":[6],"U Sl115":[1],"U Fv1992;156":[7],"U Fv1986;84":[1,14],"U 775":[13],"U 558":[6],"U 431":[12],"U 29":[29],"Sö 196":[34],"Ög 51":[4]};let r=!1;function a(e){return e.startsWith('"')||e.startsWith("&quot;")||e.includes('/"')||e.includes("/&quot;")}function i(e,t=!1){const n="((\\s+|^(·|:|×|¤|'|\\+|÷|¶))(·|:|×|¤|'|\\+|÷|¶){0,1}\\s*)",r="(·|:|×|¤|'|\\||\\+|÷|¶|\\(|\\)|\\[|\\])+",i=new RegExp(t?m(n):n,"g"),s=new RegExp(t?m(r):r),o=[];let l,c=0;function u(t,n){const r=e.slice(t,n);if("¶¶"===e.slice(t,t+2))return null;if("{÷"===e.slice(t,t+2))return null;const i=s.exec(r);if(i&&i[0].length===r.length)return null;if("^"==r)return null;const o={start:t,end:n,text:r,isPersonal:0};return o.isPersonal=a(r)?1:0,o}for(;null!==(l=i.exec(e));){if(c===l.index){c+=l[0].length;continue}const e=u(c,l.index);e&&o.push(e),c=l.index+l[0].length}if(c<e.length){const t=u(c,e.length);t&&o.push(t)}return o}function s({signature_text:e,lost:t,new_reading:n}){let r="";return t&&(r+="†"),n&&(r+="$"),r.length>0&&(r=" "+r),e+r}function o(e){const t=e.exec("SELECT meta_id, link_url, direct_url FROM runes_imagelink")[0].values;let n={};for(let e=0;e<t.length;e++){const r=t[e],a=r[0];n.hasOwnProperty(a)||(n[a]={links:[]}),n[a].links.push({indirect:r[1],direct:r[2]})}return n}function l(e){let t="",n="No images.";const r=e.links.slice(0,9),a=r.length;t='<div class="container-fluid"><div class="row">',r.map((function(e,n){n%3==0&&0!==n&&(t+="</div><div class='row'>"),t+=`<div class="col-md-4"><a href="${e.indirect}" contentEditable="false" target="_blank"><img src="${e.direct}" class="img-responsive"></a></div>`})),t+="</div></div>";const i=e.links.slice(a);return i.length>0&&(n="<ul>",i.map((function(e,t){n+=`<li><a href="${e.indirect}" contentEditable="false" target="_blank">${e.indirect}</a></li>`})),n+="</ul>"),{directImages:t,indirectImages:n}}function c(e,t){const n=e.exec("SELECT cross_id, cross_forms.id, cross_forms.name, cross_forms.group_id, cross_definitions.is_certain FROM cross_definitions INNER JOIN cross_forms ON (cross_definitions.form_id = cross_forms.id) WHERE cross_id IN (SELECT id FROM crosses WHERE meta_id = '"+t+"') ORDER BY cross_id");if(!n)return[];let r=-1,a=[];for(let e=0;e<n[0].values.length;e++){let t=parseInt(n[0].values[e][0],10);t!=r&&(r=t,a.push(Array.apply(null,Array(8)).map((function(){return[]}))));let i=n[0].values[e][2],s=n[0].values[e][3],o=n[0].values[e][4];a[a.length-1][parseInt(s,10)].push({name:i,isCertain:o})}return a}function u(e,t){const n=$(e);n.attr("data-bs-title",t).tooltip("show"),setTimeout((function(){n.tooltip("hide")}),900)}function d(){if(r)try{const e=$("#jstree").jstree(!0).get_selected(),t=p(gViewModel.getInscriptions(e));document.getElementById("mainDisplay").innerHTML=t.join("")}catch(e){console.error(`Error rendering signatures: ${e}`)}finally{r=!1}}function m(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=\/]/g,(function(e){return t[e]}))}function p(e){const t=$("#chkDisplayHeaders").is(":checked"),n=getUserSelectedFields();let r=[];for(let a=0;a<e.length;a++){const i=e[a],s=i.id,o=i.signature_text;let l=`<article signature="${o}" id="${o}" rundata-db-id="${s}" class="inscription-section">`;for(let e=0;e<n.length;e++){const r=n[e],a="signature_text"==r.schemaName?"signature_header":r.schemaName,s=r.text.en,o=r.css||"",c=r.highlight||!1;let u="";if(a in i&&(u=i[a].toString()),t?l+=`<h4>${s}</h4>`:l.length>0&&""!==u&&(l+="<br>"),u=u.replace(/ ☺ /g," "),"images"!==a)if(""!=u&&null!=u||!t)if("crosses"!==a){if(u=m(u),c&&i.hasOwnProperty("matchDetails")&&null!==i.matchDetails&&i.matchDetails.hasOwnProperty("wordIndices")){const e=i[`${a}_word_boundaries`],t=i.matchDetails.wordIndices,n=e.filter(((e,n)=>t.includes(n)));u=highlightWordsFromWordBoundaries(u,n)}if(-1!==u.indexOf("§")){const e=u.split("§");l+="Sides or/and reading variants:<ul>",e.forEach((e=>{e.trim()&&(l+=`<li><span class="${o}">§ ${e}</span></li>`)})),l+="</ul>"}else l+=`<span class="${o}">${u}</span>`}else{if(0==i.num_crosses){l+="<i>No crosses.</i>";continue}l+='<table class="crosses" border="1">',l+="<thead><tr>",l+="<th>A</th>",l+="<th>B</th>",l+="<th>C</th>",l+="<th>D</th>",l+="<th>E</th>",l+="<th>F</th>",l+="<th>G</th>",l+="</th></thead>",l+="<tbody>";const e=i.crosses;for(let t=0;t<e.length;t++)if(e[t][0].length>0)l+='<tr><td colspan="7">'+e[t][0][0].name+"</td></tr>";else{l+="<tr>";for(let n=1;n<8;n++)0!=e[t][n].length?(l+="<td>",l+=e[t][n].map((function(e,t){let n='<img src="'+getCrossUrl(e.name)+'" alt="'+e.name+'" title="'+e.name+'" width="32" height="32">';return 0==e.isCerain&&(n+="?"),n})).join(", "),l+="</td>"):l+='<td><span class="null">&#8709;</span></td>'}l+="</tbody></table>"}else l+="<i>Absent, not in the database.</i>";else{if(0==i.directImages.length){l+=i.indirectImages;continue}l+=i.directImages,i.indirectImages.length>0&&(l+="<br>"+i.indirectImages)}}l+="</article>",r.push(l)}return r}function h(e){console.error("Export error:",e),g(),gExportInProgress=!1,f("Export error: "+(e.message||"Unknown error"))}function f(e){const t=document.getElementById("alertObj");t.textContent=e,t.style.display="block",setTimeout((()=>{t.style.display="none"}),5e3)}function g(){$("#loading").hide()}function _(){$("#modalResultsIo").modal("hide")}var v=Object.freeze({__proto__:null,arraysEqual:function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!=t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0},closeResultsIoModal:_,convertDbToKeyMap:function(e){let r=e.exec("SELECT all_data.*, signatures_with_aliases.aliases FROM all_data LEFT JOIN signatures_with_aliases ON all_data.signature_id = signatures_with_aliases.signature_id");const a=r[0].columns,u=r[0].values;a.indexOf("signature_id");const d=a.indexOf("num_crosses");a.indexOf("latitude"),a.indexOf("longitude"),a.indexOf("present_latitude"),a.indexOf("present_longitude");const p=a.indexOf("id"),h=["transliteration","normalisation_norse","normalisation_scandinavian"],f=o(e);let g=0;const _=u.map((r=>{let o={};const u=r[p];for(let e=0;e<r.length;e++){const t=a[e];o[t]=r[e],null===r[e]&&(o[t]=""),h.includes(t)&&(o[`${t}_html`]=m(r[e]),o[`${t}_word_boundaries`]=i(o[`${t}_html`],!0))}if("Sö 145"===o.signature_text&&(o.transliteration_html=m(o.transliteration.replace(": ata i ::",": ata_i ::")),o.transliteration_word_boundaries=i(o.transliteration_html,!0),o.transliteration_word_boundaries[22].text="ata i"),t.hasOwnProperty(o.signature_text)){const e=t[o.signature_text];o.normalisation_norse_word_boundaries=o.normalisation_norse_word_boundaries.filter(((t,n)=>!e.includes(n))),o.normalisation_scandinavian_word_boundaries=o.normalisation_scandinavian_word_boundaries.filter(((t,n)=>!e.includes(n)))}if(n.hasOwnProperty(o.signature_text)){const e=n[o.signature_text];o.transliteration_word_boundaries=o.transliteration_word_boundaries.filter(((t,n)=>!e.includes(n)))}if(0==o.transliteration_word_boundaries.length&&1==o.normalisation_norse_word_boundaries.length&&"..."==o.normalisation_norse_word_boundaries[0].text&&(o.normalisation_norse_word_boundaries=[],o.normalisation_scandinavian_word_boundaries=[]),h.forEach((e=>{o[`${e}_words`]=o[`${e}_word_boundaries`].map((e=>e.text))})),g+=o.transliteration_word_boundaries.length!==o.normalisation_norse_word_boundaries.length?1:0,o.signature_display=s(o),o.aliases?o.signature_header=o.signature_text+" ("+o.aliases+")":o.signature_header=o.signature_text,f.hasOwnProperty(u)){const e=l(f[u]);o.directImages=e.directImages,o.indirectImages=e.indirectImages}else o.directImages="",o.indirectImages="No images.";let _=r[d];return o.crosses=_>0?c(e,r[p]):[],o})),v=new Map;return _.forEach((e=>{v.set(e.id,e)})),console.log(`Number of signatures with different word boundaries (it should be 0): ${g}`),v},crossesForMeta:c,displaySignatureInfo:function e(){if(0!=$("#jstree").jstree(!0).get_selected().length){if(r)return r=!1,void setTimeout(e,300);document.getElementById("mainDisplay").innerHTML="<img src='https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.7/themes/default-dark/throbber.gif'><br>",r=!0,setTimeout(d,100)}},fetchAllImages:o,getHumanName:function(t,n="en"){const r=e.find((e=>e.schemaName===t));return r&&r.text[n]||t},hideLoading:g,initClipboardButtons:function(){document.querySelectorAll(".clip").forEach((e=>{e.addEventListener("click",(function(){const t=e.innerText;navigator.clipboard.writeText(t).then((function(){u(e,"Copied to clipboard!")})).catch((function(t){u(e,"Failed to copy!")}))}))}))},inscriptions2Select:function(e,t){e.innerHTML="",t.forEach(((t,n)=>{const r=document.createElement("option");r.value=n,r.text=t.signature_display,e.appendChild(r)}))},inscriptions2markup:p,inscriptions2treeNodes:function(e){return(e instanceof Map?Array.from(e.values()):e).map((e=>({id:e.id.toString(),text:e.signature_display,normalizedText:e.signature_text.normalize("NFD").replace(/[\u0300-\u036f]/g,""),icon:!1,signature:e.signature_text})))},isPersonalName:a,makeImagesMarkup:l,onExportError:h,onExportWorkerMessage:function(e){if(gExportInProgress=!1,e.data.error)h({message:e.data.message});else try{if(e.data.buffer){const t=new Blob([e.data.buffer],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),n=document.createElement("a");n.href=URL.createObjectURL(t),n.download="rundata-net_results.xlsx",document.body.appendChild(n),n.click(),document.body.removeChild(n),_()}}catch(e){h(e)}finally{g()}},prepareSignumForDisplay:s,schemaFieldsInfo:e,selectFirstSignature:function(){let e=$("#jstree").jstree(!0).get_node("#");$("#jstree").jstree(!0).select_node(e.children[0])},showAlert:f,showLoading:function(e){const t=document.getElementById("txtLoadingDescription");t&&(t.textContent=e||"It can take up to a minute."),$("#loading").show()}});const y="userSelectedDisplay",x="showHeaders";function b(e){let t;try{t=window[e];const n="__storage_test__";return t.setItem(n,n),t.removeItem(n),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}}function w(){const e=["signature_text","transliteration","english_translation","found_location","parish","municipality","district","current_location","images"];if(!b("localStorage"))return e;try{const e=window.localStorage;if(e.getItem(y))return JSON.parse(e.getItem(y))}catch(e){console.error("Error while reading user selected display from local storage:",e)}return e}function I(e=null){if(!b("localStorage"))return;const t=window.localStorage,n=JSON.stringify(e?[].concat(e):[]);t.setItem(y,n)}function N(e,t){let n=0;$("#multiselect_to").empty(),$("#multiselect").empty(),e.forEach((e=>{const t=schemaFieldsInfo.find((t=>t.schemaName===e));t&&$("#multiselect_to").append($("<option>",{value:t.schemaName,text:t.text.en,sortValue:n++}))})),schemaFieldsInfo.forEach((t=>{-1===e.indexOf(t.schemaName)&&$("#multiselect").append($("<option>",{value:t.schemaName,text:t.text.en,sortValue:n++}))})),"boolean"!=typeof t&&(t="true"===t),$("#chkDisplayHeaders").prop("checked",t)}function S(e){e.preventDefault();const t=$("#formatDialogAlertObj"),n=$("#multiselect_to option").map(((e,t)=>$(t).val())).toArray();if(null===n||0==n.length)return t.html("Nothing is selected for display! Please select at least one property."),void t.show();t.hide();const r=localStorage.getItem(x),a=JSON.parse(localStorage.getItem(y)),i=$("#chkDisplayHeaders").is(":checked");arraysEqual(a,n)&&r==i||(I(n),localStorage.setItem(x,i),$("#multiselect").trigger("displayUpdated",{message:"hello"})),$(this).prev().click()}var E=Object.freeze({__proto__:null,getUserSelectedDisplay:w,getUserSelectedFields:function(){return w().map((e=>schemaFieldsInfo.find((t=>t.schemaName===e))))},initMultiselect:function(){const e=["signature_text","transliteration","normalisation_scandinavian","normalisation_norse","english_translation","swedish_translation","found_location","parish","municipality","district","current_location","original_site","images","rune_type","carver","num_crosses","crosses","dating","style","material_type","material","objectInfo","reference","additional"],t=localStorage.getItem(y),n=t?JSON.parse(t):e,r=localStorage.getItem(x);N(n,!r||"true"===r),$("#multiselect").multiselect({keepRenderingSortRight:!1,skipInitSortRight:!1,sort:{left:function(e,t){return parseInt($(e).attr("sortValue"))>parseInt($(t).attr("sortValue"))?1:-1},right:function(e,t){return parseInt($(e).attr("sortValue"))>parseInt($(t).attr("sortValue"))?1:-1}}}),$("#formatDialogAlertObj").hide(),document.getElementById("btnApplyDisplayFormat").addEventListener("click",S),document.getElementById("btnDismissDisplayFormat").addEventListener("click",(()=>{const t=localStorage.getItem(x),n=!t||"true"===t,r=localStorage.getItem(y);N(r?JSON.parse(r):e,n)})),document.getElementById("divFormatDialog").addEventListener("shown.bs.modal",(e=>{$("#formatDialogAlertObj").hide();const t=$("#chkDisplayHeaders").is(":checked");I($("#multiselect_to option").map(((e,t)=>$(t).val())).toArray()),localStorage.setItem(x,t)}))},saveUserSelectedDisplay:I});function k(){try{return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}catch(e){return!1}}function R(e,t,n,r=L){if(0===t||0===n)return null;let a=r.marker([t,n],{signature:e.signature_text,id:e.id}),i=`${e.signature_text}<br>`;return k()&&(i+=`<a href="${function(e,t){if("function"!=typeof isSafari)throw console.error("isSafari function is not defined"),new Error("isSafari function is not defined");return isSafari()?`http://maps.apple.com/?daddr=${e},${t}`:`geo:${e},${t}?q=${e},${t}`}(t,n)}" target="_self">Drive here!</a>`),k()&&a.bindPopup(i,{autoClose:!1}),a.bindTooltip(e.signature_text,{permanent:!0}).openTooltip(),a}var O=Object.freeze({__proto__:null,initMap:function(e,t=[56.607512,16.439838],n=8){const r=L.map(e,{fullscreenControl:!0}).setView(t,n);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'© <a href="https://openstreetmap.org">OpenStreetMap</a> contributors'}).addTo(r),L.control.locate({strings:{title:"My location"}}).addTo(r);const a=L.markerClusterGroup({showCoverageOnHover:!0,chunkedLoading:!0,maxClusterRadius:60});return a.on("click",(function(e){scrollToInscription(e.layer.options.signature,e.layer.options.id)})),a.addTo(r),{map:r,markers:a}},inscriptions2markers:function(e,t=L){const n=new Map;return e.forEach(((e,r)=>{e.signature_text;const a=parseFloat(e.latitude)||0,i=parseFloat(e.longitude)||0,s=parseFloat(e.present_latitude)||0,o=parseFloat(e.present_longitude)||0,l=R(e,a,i,t);if(!l)return;n.has(r)||n.set(r,{found:null,present:null}),n.get(r).found=l;const c=R(e,s,o,t);n.get(r).present=c||l})),n},onHideMapClicked:function(e,t){const n=`#${e}`,r=`#${t}`;$(n).toggle(),$(n).is(":visible")?$(r).html("Hide map"):$(r).html("Show map")},showMarkers:function({preserveMapArea:e=!1,showOriginalLocation:t=!1,inscriptionIds:n=[],allMarkers:r=new Map,mapObject:a=null,markersLayer:i=null}={}){let s=[];if(i&&a){i.clearLayers();for(let e=0;e<n.length;e++){const a=n[e];if(!r.has(a))continue;const o=r.get(a),l=t?o.found:o.present;i.addLayers(l),s.push(l.getLatLng())}s.length>0&&!e&&a.fitBounds(s)}else console.log("No markers layer or map object provided")}});const C={"bt-tooltip-errors":null,sortable:null,"not-group":null},A={gr_signature:{en:"Inscription",sv:"Signatura"},gr_texts:"Texts",gr_location:"Location",other:"---"};$.fn.queryBuilder.define("case-rule",(function(e){let t=this;this.on("afterInit",(function(){t.$el.on("click.queryBuilder","[data-case=rule]",(function(){let e=$(this).closest($.fn.queryBuilder.constructor.selectors.rule_container),n=t.getModel(e);n.ignoreCase=!n.ignoreCase})),t.model.on("update",(function(e,n,r){n instanceof $.fn.queryBuilder.constructor.Rule&&"ignoreCase"===r&&t.updateRuleCaseIgnore(n)}))})),this.on("afterAddRule",(function(e,t){t.__.ignoreCase=!1})),this.on("afterCreateRuleInput.filter",(function(e,t){t.filter&&"string"==typeof t.filter.input?-1===t.filter.input.indexOf("text")?t.$el.find(M).hide():t.$el.find(M).show():t.$el.find(M).hide()})),e.disable_template||this.on("getRuleTemplate.filter",(function(n){var r=$($.parseHTML(n.value));r.find($.fn.queryBuilder.constructor.selectors.rule_actions).prepend('\n<button type="button" class="btn btn-xs btn-default" active data-case="rule"><i class="'+e.icon_checked+'"></i> <span class="case-rule-text">'+t.translate("Match case")+"</span></button>"),n.value=r.prop("outerHTML")})),this.on("ruleToJson.filter",(function(e,t){e.value.ignoreCase=t.ignoreCase})),this.on("jsonToRule.filter",(function(e,t){e.value.ignoreCase=!!t.ignoreCase})),this.on("ruleToSQL.filter",(function(e,t,n,r){console.log(`ruleToSQL.filter: ${t.id}, ignoreCase: ${t.ignoreCase}`),t.ignoreCase&&(e.value="NOCASE ( "+e.value+" )")}))}),{icon_checked:"bi bi-check2-square",disable_template:!1}),$.fn.queryBuilder.constructor.utils.defineModelProperties($.fn.queryBuilder.constructor.Rule,["ignoreCase"]);const M=$.fn.queryBuilder.constructor.selectors.rule_actions+" [data-case=rule]";function D(e,t){t.forEach(((e,t)=>{}));const n={};e.forEach((e=>{const t=e.optgroup||"";n[t]||(n[t]=[]),n[t].push(e)})),Object.keys(n).forEach((e=>{n[e].sort(((e,t)=>{const n=e.label||"",r=t.label||"";return n.localeCompare(r)}))}));let r=[];return t.forEach((e=>{n[e]&&(r=r.concat(n[e]),delete n[e])})),Object.values(n).forEach((e=>{r=r.concat(e)})),r}function F(e,t){if(!e)throw new Error("dataSource parameter is required");if(!t||"string"!=typeof t)throw new Error("fieldName parameter is required and must be a string");let n=null,r=null,a=!1;const i=e=>{if(!e||void 0===e[t]||null===e[t])return;const i="string"==typeof e[t]?parseFloat(e[t]):e[t];if(!isNaN(i)){if(!a)return n=i,r=i,void(a=!0);i<n&&(n=i),i>r&&(r=i)}};if(e instanceof Map)for(const t of e.values())i(t);else{if(!Array.isArray(e))throw new Error("dataSource must be either a Map or an Array");for(const t of e)i(t)}return a?{min:n,max:r}:null}function T(e,t,n,r,a=!1){let i=[];const s=new Set;let o=2e4;if(Array.from(r.values()).forEach((e=>{const t=s.has(e[n]);if(e[n]&&""!==e[n]&&!t&&(s.add(e[n]),i.push({text:e[n],id:e[n],score:e.id||0}),"signature_text"===n&&e.aliases)){e.aliases.split("|").map((e=>e.trim())).filter((e=>e)).forEach((e=>{s.has(e)||(s.add(e),i.push({text:e,id:e,score:o++}))}))}})),i.sort(((e,t)=>e.score-t.score)),""!==e){const t=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();i=i.filter((e=>e.text.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().includes(t)))}if(a)return t(i),i;const l=i.map((e=>e.text));return t(l),l}function U(e,t,n,r={}){if(void 0===e)throw new Error("prepareAutoComplete: 'ruleId' parameter is required");if(!(t&&t instanceof Map))throw new Error("prepareAutoComplete: 'dbMap' parameter is required and must be a Map");if(!n||"function"!=typeof n)throw new Error("prepareAutoComplete: 'humanNameGetter' parameter is required and must be a function");const a=r.fieldId||e,i=r.operators||["contains","not_contains","equal","not_equal","begins_with","not_begins_with","ends_with","not_ends_with","is_empty","is_not_empty"],s=r.type||"string",o=r.size||100,l=r.optgroup||"other";return{id:e,field:a,optgroup:l,label:n(e),type:s,plugin:"autoComplete",plugin_config:{minChars:0,delay:100,source:function(e,n){T(e,n,a,t)},menuClass:" clusterize-content ",attachToParent:!0},size:o,operators:i}}function q(e,t,n,r){if(void 0===e)throw new Error("prepareIntegerRule: 'ruleId' parameter is required");if(!(t&&t instanceof Map))throw new Error("prepareIntegerRule: 'dbMap' parameter is required and must be a Map");if(!n||"function"!=typeof n)throw new Error("prepareIntegerRule: 'humanNameGetter' parameter is required and must be a function");r||(r={});const a=r.fieldId||e,i=r.operators||["equal","not_equal","less","less_or_equal","greater","greater_or_equal","between","not_between"],s=r.size||10;let o={id:e,field:a,optgroup:r.optgroup||"other",label:n(a),type:"integer",size:s,operators:i,input:"number"};const l=F(t,a);return r.min=r.min||l&&l.min,r.max=r.max||l&&l.max,void 0===r.min&&void 0===r.max&&void 0===r.step||(o.validation={allow_empty_value:!0},void 0!==r.min&&(o.validation.min=r.min),void 0!==r.max&&(o.validation.max=r.max),void 0!==r.step&&(o.validation.step=r.step)),void 0!==r.default_value&&(o.default_value=r.default_value),o}function B(e,t={},n={}){var r=e.$el.find(".rule-value-container input");const a=e.operator.type;void 0!==r.data("tomSelect")&&r.tomSelect("destroy"),r.hasClass("autocomplete")&&r.autoComplete("destroy"),"in"===a||"not_in"===a?r.tomSelect(t):r.autoComplete(n)}function j(e){const t="Normalization",n="Transliteration";return{id:e.id,field:e.field,label:e.label,type:"string",optgroup:e.optgroup||"gr_texts",data:{multiField:!0},input:function(e,r){return`\n        <div class="form-group">\n          <div class="input-group mb-3 pt-2">\n            <span class="input-group-text" id="${r}_normalization_input_span">${t}</span>\n            <input type="text" id="${r}_normalizationInput" class="form-control" placeholder="" aria-label="${t}" aria-describedby="${r}_normalization_input_span">\n          </div>\n          <div class="input-group">\n            <span class="input-group-text" id="${r}_transliteration_input_span">${n}</span>\n            <input type="text" id="${r}_transliterationInput" class="form-control" placeholder="" aria-label="${n}" aria-describedby="${r}_transliteration_input_span">\n          </div>\n          <div class="mt-2">\n            <div class="form-check form-check-inline">\n              <input class="form-check-input" type="radio" name="${r}_personalNamesMode" value="includeAll" id="${r}_includeAddInput" checked>\n              <label class="form-check-label" for="${r}_includeAddInput">Include personal names</label>\n            </div>\n            <div class="form-check form-check-inline">\n              <input class="form-check-input" type="radio" name="${r}_personalNamesMode" value="excludeNames" id="${r}_excludeNamesInput">\n              <label class="form-check-label" for="${r}_excludeNamesInput">Exclude personal names</label>\n            </div>\n            <div class="form-check form-check-inline">\n              <input class="form-check-input" type="radio" name="${r}_personalNamesMode" value="namesOnly" id="${r}_namesOnlyInput">\n              <label class="form-check-label" for="${r}_namesOnlyInput">Personal names only</label>\n            </div>\n          </div>\n        </div>\n      `},operators:e.operators||["contains","equal","begins_with","ends_with"],valueGetter:function(e){var t=e.$el.find(".rule-value-container");return{normalization:t.find("[id$=_normalizationInput]").val(),transliteration:t.find("[id$=_transliterationInput]").val(),names_mode:t.find("[name$=_personalNamesMode]:checked").val()}},valueSetter:function(e,t){const n=t.names_mode||"includeAll";var r=e.$el.find(".rule-value-container");r.find("[id$=_normalizationInput]").val(t.normalization||""),r.find("[id$=_transliterationInput]").val(t.transliteration||""),r.find('[name$=_personalNamesMode][value="'+n+'"]').prop("checked",!0)}}}$.fn.queryBuilder.extend({updateRuleCaseIgnore:function(e){e.$el.find(M+"> .case-rule-text").text(this.translate(e.ignoreCase?"Ignore case":"Match case")),this.trigger("afterUpdateRuleCaseSelector",e),this.trigger("rulesChanged")}});var z=Object.freeze({__proto__:null,getMinMaxValues:F,getValuesFromAllData:T,initQueryBuilder:function(e,t,n){const r=t.getAllInscriptions(),a=$(`#${e}`),i=$.fn.queryBuilder.constructor.DEFAULTS.operators.concat([{type:"in_separated_list",nb_inputs:1,multiple:!1,apply_to:["string"]},{type:"cross_form",nb_inputs:1,multiple:!1,apply_to:["string"]}]),s={minChars:0,delay:100,source:function(e,t){T(e,t,"signature_text",r)},menuClass:"clusterize-content",attachToParent:!0},o={plugins:["remove_button"],load:function(e,t){T(e,t,"signature_text",r,!0),this.settings.load=null},preload:!0,valueField:"id",hideSelected:!0,delimiter:"|"};let l=[{id:"inscription_id",optgroup:"gr_signature",field:"signature_text",label:n("signature_text"),type:"string",multiple:!0,data:{multiField:!0},operators:["in","in_separated_list","begins_with","not_begins_with","ends_with","not_ends_with","contains","not_contains"],valueSetter:function(e,t){e.$el.find(".rule-value-container input").val(t),B(e,o,s)},plugin:"tomSelect",plugin_config:o},U("carver",r,n),{id:"inscription_country",optgroup:"gr_signature",field:"signature_text",label:"Country or Swedish province",type:"string",input:"select",multiple:!0,data:{multiField:!0},operators:["in"],plugin:"tomSelect",plugin_config:{plugins:["remove_button"],options:[{text:"Sweden, whole",value:"all_sweden"},{text:"Öland (Öl)",value:"Öl "},{text:"Östergötland (Ög)",value:"Ög "},{text:"Södermanland (Sö)",value:"Sö "},{text:"Småland (Sm)",value:"Sm "},{text:"Västergötland (Vg)",value:"Vg "},{text:"Uppland (U)",value:"U "},{text:"Västmanland (Vs)",value:"Vs "},{text:"Närke (Nä)",value:"Nä "},{text:"Värmland (Vr)",value:"Vr "},{text:"Gästrikland (Gs)",value:"Gs "},{text:"Hälsingland (Hs)",value:"Hs "},{text:"Medelpad (M)",value:"M "},{text:"Ångermanland (Ån)",value:"Ån "},{text:"Dalarna (D)",value:"D "},{text:"Härjedalen (Hr)",value:"Hr "},{text:"Jämtland (J)",value:"J "},{text:"Lappland (Lp)",value:"Lp "},{text:"Dalsland (Ds)",value:"Ds "},{text:"Bohuslän (Bo)",value:"Bo "},{text:"Gotland (G)",value:"G "},{text:"Sweden, other (SE)",value:"SE "},{text:"Denmark (DR)",value:"DR "},{text:"Norway (N)",value:"N "},{text:"Faroe Islands (FR)",value:"FR "},{text:"Greenland (GR)",value:"GR "},{text:"Iceland (IS)",value:"IS "},{text:"Finland (FI)",value:"FI "},{text:"Shetland (Sh)",value:"Sh "},{text:"Orkney (Or)",value:"Or "},{text:"Scotland (Sc)",value:"Sc "},{text:"England (E)",value:"E "},{text:"Isle of Man (IM)",value:"IM "},{text:"Ireland (IR)",value:"IR "},{text:"France (F)",value:"F "},{text:"Netherlands (NL)",value:"NL "},{text:"Germany (DE)",value:"DE "},{text:"Poland (PL)",value:"PL "},{text:"Latvia (LV)",value:"LV "},{text:"Russia (RU)",value:"RU "},{text:"Ukraine (UA)",value:"UA "},{text:"Byzantium (By)",value:"By "},{text:"Italy (IT)",value:"IT "},{text:"Other areas (X)",value:"X "}],hideSelected:!0},valueSetter:function(e,t){e.$el.find(".rule-value-container select").tomSelect("setValue",t)}},j({id:"normalization_norse_to_transliteration",field:"normalization_norse",label:"Normalization Norse to Transliteration",optgroup:"gr_texts"}),j({id:"normalization_scandinavian_to_transliteration",field:"normalisation_scandinavian",label:"Normalization Scandinavian to Transliteration",optgroup:"gr_texts"}),U("english_translation",r,n,{optgroup:"gr_texts"}),U("swedish_translation",r,n,{optgroup:"gr_texts"}),U("full_address",r,n,{optgroup:"gr_location",operators:["contains"]}),U("found_location",r,n,{optgroup:"gr_location"}),U("parish",r,n,{optgroup:"gr_location"}),U("district",r,n,{optgroup:"gr_location"}),U("municipality",r,n,{optgroup:"gr_location"}),U("current_location",r,n,{optgroup:"gr_location"}),U("original_site",r,n),U("parish_code",r,n,{optgroup:"gr_location"}),U("rune_type",r,n),U("dating",r,n),q("year_from",r,n,{operators:["equal","less","greater","between"]}),q("year_to",r,n,{operators:["equal","less","greater","between"]}),U("style",r,n),U("material",r,n),U("material_type",r,n),U("objectInfo",r,n),U("reference",r,n),U("additional",r,n),q("num_crosses",r,n,{operators:["equal","less","greater","between"]}),{id:"cross_form",field:"crosses",label:n("cross_form"),operators:["cross_form"],optgroup:"other",input:function(e,n){return`\n          <select name="${n}_1" class="form-select" aria-label="Cross form">${t.getAllCrossForms().map((e=>`<option value="${e}">${e}</option>`)).join("")}</select>\n          <div>Certain?\n            <div class="form-check form-check-inline">\n              <input type="radio" name="${n}_2" value="0" class="form-check-input" id="${n}_2_0">\n              <label for="${n}_2_0" class="form-check-label">No</label>\n            </div>\n\n            <div class="form-check form-check-inline">\n              <input type="radio" name="${n}_2" value="1" class="form-check-input" id="${n}_2_1">\n              <label for="${n}_2_1" class="form-check-label">Yes</label>\n            </div>\n\n            <div class="form-check form-check-inline">\n              <input type="radio" name="${n}_2" value="2" class="form-check-input" id="${n}_2_2" checked>\n              <label for="${n}_2_2" class="form-check-label">Doesn't matter</label>\n            </div>\n          </div>`},valueGetter:function(e){return{form:e.$el.find(".rule-value-container [name$=_1]").val(),is_certain:e.$el.find(".rule-value-container [name$=_2]:checked").val()}},valueSetter:function(e,t){$(e.$el.find(".rule-value-container [name$=_1]")[0]).val(t.form),e.$el.find(`.rule-value-container [name$=_2][value=${t.is_certain}]`).prop("checked",!0)}},{id:"has_personal_name",label:"Has personal name(s)?",field:"num_names",optgroup:"other",type:"integer",input:"radio",values:[{0:"No"},{1:"Yes"}],default_value:1,operators:["equal"]}];l=D(l,Object.keys(A));const c=l[0];l[0]=l[1],l[1]=c,a.queryBuilder({display_empty_filter:!1,plugins:C,filters:l,sort_filters:!1,allow_empty:!1,optgroups:A,operators:i,lang:{operators:{in_separated_list:"is in |-separated list",cross_form:" "}},sqlOperators:{in_separated_list:{op:"IN",mod:"{0}"},cross_form:{op:"IN"}},templates:{rule:({rule_id:e,icons:t,settings:n,translate:r,builder:a})=>`\n  <div id="${e}" class="rule-container d-flex align-items-center w-100">\n    <div class="rule-header">\n    </div>\n    ${n.display_errors?`\n      <div class="error-container flex-shrink-0"><i class="${t.error}"></i></div>\n    `:""}\n    <div class="rule-filter-container flex-shrink-0"></div>\n    <div class="rule-operator-container flex-shrink-0"></div>\n    <div class="rule-value-container flex-grow-1 me-2"></div>\n    <div class="rule-footer d-flex align-items-center ms-auto">\n      <div class="btn-group flex-shrink-0 rule-actions">\n        <button type="button" class="btn btn-sm btn-danger" data-delete="rule">\n          <i class="${t.remove_rule}"></i> ${r("delete_rule")}\n        </button>\n      </div>\n    </div>\n  </div>`}}),$("#builder").on("afterCreateRuleInput.queryBuilder afterUpdateRuleOperator.queryBuilder",(function(e,t){"inscription_id"===t.filter.id&&B(t,o,s)}))},sortGroupsByOrder:D});function P(e){return String(e).replace(/\s/g," ")}const G={equal:(e,t)=>e==t,not_equal:(e,t)=>e!=t,in:(e,t)=>t.includes(e),not_in:(e,t)=>!t.includes(e),less:(e,t)=>e<t,less_or_equal:(e,t)=>e<=t,greater:(e,t)=>e>t,greater_or_equal:(e,t)=>e>=t,between:(e,t)=>t[0]<=e&&e<=t[1],not_between:(e,t)=>!(t[0]<=e&&e<=t[1]),begins_with:(e,t)=>P(e).startsWith(P(t)),not_begins_with:(e,t)=>!P(e).startsWith(P(t)),contains:(e,t)=>P(e).includes(P(t)),not_contains:(e,t)=>!P(e).includes(P(t)),ends_with:(e,t)=>P(e).endsWith(P(t)),not_ends_with:(e,t)=>!P(e).endsWith(P(t)),is_empty:e=>""===e||null==e||Array.isArray(e)&&0===e.length,is_not_empty:e=>""!==e&&null!=e&&(!Array.isArray(e)||e.length>0),is_null:e=>null==e,is_not_null:e=>null!=e};class V{constructor(e={}){this.operators={...G},this.customSearchFunctions=e}parseRules(e,t){if(!e||!t)return[];if(!1===e.valid)return[];const n=[];if(Array.isArray(t))t.forEach((t=>{const r=this._evaluateGroup(e,t);r.match&&n.push({record:t,matchDetails:r.details||null})}));else if("function"==typeof t[Symbol.iterator])for(const r of t){const t=this._evaluateGroup(e,r);t.match&&n.push({record:r,matchDetails:t.details||null})}else{if("function"!=typeof t.next)throw new Error("Data is not iterable. It must be an array or implement the iterator protocol.");{let r=t.next();for(;!r.done;){const a=this._evaluateGroup(e,r.value);a.match&&n.push({record:r.value,matchDetails:a.details||null}),r=t.next()}}}return n}_evaluateGroup(e,t){const n=(e,t)=>t?{match:!e.match}:e;if(!e.condition||!e.rules)return n({match:!1},e.not);const r=e.condition.toUpperCase(),a=e.rules;if(!a||!a.length)return n({match:!0},e.not);const i=a.map((e=>e.rules?this._evaluateGroup(e,t):e.id&&e.operator?this._evaluateRule(e,t):{match:!1}));let s=null;if("AND"===r){const e=i.every((e=>e.match));s={match:e,details:e?i.reduce(((e,t)=>(t.details&&Object.entries(t.details).forEach((([t,n])=>{e[t]?Array.isArray(e[t])&&Array.isArray(n)&&(e[t]=[...new Set([...e[t],...n])]):e[t]=n})),e)),{}):null}}else{if("OR"!==r)throw new Error(`Unknown condition: ${r}`);{const e=i.filter((e=>e.match)),t=e.length>0;s={match:t,details:t?e[0].details:null}}}return n(s,e.not)}_evaluateRule(e,t){const n=e.field||e.id,r=e.operator,a=e.data&&!0===e.data.multiField;if(e.id&&this.customSearchFunctions[e.id]&&"function"==typeof this.customSearchFunctions[e.id][r]){const i=a?t:t[n],s=this.customSearchFunctions[e.id][r](i,e.value);return"object"==typeof s&&"match"in s?s:{match:Boolean(s)}}if(!a&&!(n in t))return{match:!1};if(a)return{match:!1};const i=t[n];if(["is_empty","is_not_empty","is_null","is_not_null"].includes(r)){const e=this.operators[r](i);return{match:e,details:e?{[n]:!0}:null}}const s=e.value;if(null==s)return{match:!1};if("number"==typeof s&&""===i)return{match:!1};const o=this.operators[r](i,s),l=Boolean(o);return{match:l,details:l?{[n]:!0}:null}}addOperator(e,t){this.operators[e]=t}addTypeConverter(e,t){this.typeConverters[e]=t}}const H=(e,t,n,r=!1)=>{const a=[e.signature_text,...e.aliases?e.aliases.split("|").map((e=>e.trim())).filter((e=>e)):[]],i=Array.isArray(t)?t:"string"==typeof t&&t.indexOf("|")>-1?t.split("|"):[t];let s=a.some((e=>i.some((t=>n(e,t)))));return r&&(s=!s),{match:s}},W=(e,t,n,r)=>{const a=Y(r),i=t.normalization,s=t.transliteration,o=t.names_mode,l=e[`${n.includes("norse")?"normalisation_norse":"normalisation_scandinavian"}_words`],c=e.transliteration_words;let u=!1,d=[],m=0;const p=(e,t)=>!("excludeNames"===o&&t||"namesOnly"===o&&!t)&&(u=!0,d.push(e),t&&m++,!0);if(i&&s)for(let e=0;e<Math.min(l.length,c.length);e++)a(l[e],i)&&a(c[e],s)&&p(e,isPersonalName(l[e]));else i&&l.forEach(((e,t)=>{a(e,i)&&p(t,isPersonalName(e))})),s&&c.forEach(((e,t)=>{if(a(e,s)){const e=t<l.length&&isPersonalName(l[t]);p(t,e)}}));return{match:u,details:u?{wordIndices:d,numPersonalNames:m}:null}},J=(e,t)=>({match:0===t?0===e:e>0}),Q={inscription_id:{in:(e,t)=>H(e,t,G.equal),in_separated_list:(e,t)=>H(e,t,G.equal),begins_with:(e,t)=>H(e,t,G.begins_with),not_begins_with:(e,t)=>H(e,t,G.begins_with,!0),ends_with:(e,t)=>H(e,t,G.ends_with),not_ends_with:(e,t)=>H(e,t,G.ends_with,!0),contains:(e,t)=>H(e,t,G.contains),not_contains:(e,t)=>H(e,t,G.contains,!0),equal:(e,t)=>H(e,t,G.equal),not_equal:(e,t)=>H(e,t,G.not_equal)},inscription_country:{in:(e,t)=>{for(let n=0;n<t.length;n++){if("all_sweden"==t[n]){const t=["Öl ","Ög ","Sö ","Sm ","Vg ","U ","Vs ","Nä ","Vr ","Gs ","Hs ","M ","Ån ","D ","Hr ","J ","Lp ","Ds ","Bo ","G ","SE ","Bo"];for(let n=0;n<t.length;n++)if(G.begins_with(e.signature_text,t[n]))return{match:!0};const n=["Skåne","Halland","Blekinge"];for(let t=0;t<n.length;t++)if(G.contains(e.district,n[t]))return{match:!0};return{match:!1}}if(G.begins_with(e.signature_text,t[n]))return{match:!0}}return{match:!1}}},normalization_norse_to_transliteration:{contains:(e,t)=>W(e,t,"norseToTransliteration","includes"),equal:(e,t)=>W(e,t,"norseToTransliteration","exact"),begins_with:(e,t)=>W(e,t,"norseToTransliteration","beginsWith"),ends_with:(e,t)=>W(e,t,"norseToTransliteration","endsWith")},normalization_scandinavian_to_transliteration:{contains:(e,t)=>W(e,t,"scandinavianToTransliteration","includes"),equal:(e,t)=>W(e,t,"scandinavianToTransliteration","exact"),begins_with:(e,t)=>W(e,t,"scandinavianToTransliteration","beginsWith"),ends_with:(e,t)=>W(e,t,"scandinavianToTransliteration","endsWith")},cross_form:{cross_form:(e,t)=>{if(!e||0===e.length)return{match:!1};const n=parseInt(t.is_certain,10),r=t.form;for(const t of e)if(Array.isArray(t))for(const e of t)if(Array.isArray(e))for(const t of e)if(t.name===r&&(2===n||n===t.isCertain))return{match:!0};return{match:!1}}},has_personal_name:{equal:J,not_equal:(e,t)=>({match:!J(e,t).match})}};function Y(e,t={}){const{ignoreCase:n=!1}=t,r=n?e=>String(e).toLowerCase():e=>String(e),a=e=>{if(e.includes("&#x2F;")||e.includes("/")){return e.split(/&#x2F;|\//).map((e=>e.trim().replace(/^(&quot;|")/,"")))}return[e]};switch(e){case"exact":return(e,t)=>a(e).some((e=>r(e)===r(t)));case"beginsWith":return(e,t)=>a(e).some((e=>r(e).startsWith(r(t))));case"endsWith":return(e,t)=>a(e).some((e=>r(e).endsWith(r(t))));case"regex":return(e,t)=>{try{return new RegExp(t,n?"i":"").test(e)}catch(e){throw new Error(`Invalid regex pattern: ${t}`)}};default:return(e,t)=>a(e).some((e=>r(e).includes(r(t))))}}var K=Object.freeze({__proto__:null,QueryBuilderParser:V,calcWordsAndPersonalNames:function(e){let t=0,n=0,r=0;try{const a=e.values();for(const e of a)e.matchDetails&&e.matchDetails.wordIndices?(t+=e.matchDetails.wordIndices.length,n+=e.matchDetails.numPersonalNames):(t+=e.normalisation_norse_word_boundaries.length,e.normalisation_norse_word_boundaries.forEach((e=>{n+=e.isPersonal}))),r++}catch(e){console.error("Error calculating words and personal names:",e)}$(document).trigger("updateSignatureCount",{count:r}),$(document).trigger("updateWordCount",{count:t}),$(document).trigger("updatePersonalNameCount",{count:n})},doSearch:function(e,t){return new V(Q).parseRules(e,t).map((({record:e,matchDetails:t})=>({...e,matchDetails:t})))},getWordSearchFunction:Y,highlightWordsFromWordBoundaries:function(e,t){t.sort(((e,t)=>e.start-t.start));let n="",r=0;return t.forEach((({start:t,end:a,text:i})=>{n+=e.slice(r,t),n+=`<span class="highlight">${e.slice(t,a)}</span>`,r=a})),n+=e.slice(r),n},operators:G});var X=Object.freeze({__proto__:null,RunicViewModel:class{constructor(e){this.dbMap=e,this.searchResults=null,this.currentSelectionIds=[],this.allCrossForms=new Set;for(const t of e.values())if(t.crosses&&Array.isArray(t.crosses))for(const e of t.crosses)if(Array.isArray(e))for(const t of e)if(Array.isArray(t))for(const e of t)this.allCrossForms.add(e.name);this.allCrossForms=Array.from(this.allCrossForms).sort()}getInscriptionData(e){return this.searchResults&&this.searchResults.has(e)?this.searchResults.get(e):this.dbMap.get(e)}getAllCrossForms(){return this.allCrossForms}getInscriptions(e){return this.searchResults&&this.searchResults.size>0?e.map((e=>this.searchResults.get(parseInt(e,10)))):e.map((e=>this.dbMap.get(parseInt(e,10))))}getAllInscriptions(){return this.dbMap}getActiveInscriptions(){return this.searchResults?Array.from(this.searchResults.values()):Array.from(this.dbMap.values())}getActiveInscriptionIds(){return this.searchResults?Array.from(this.searchResults.keys()):Array.from(this.dbMap.keys())}setSearchResults(e){e?(this.searchResults=new Map,e.forEach((e=>{this.searchResults.set(e.id,e)})),$(document).trigger("viewModelUpdated",{source:"search",count:this.searchResults.size,model:this})):this.searchResults=null}clearSearchResults(){this.searchResults=null,$(document).trigger("viewModelUpdated",{source:"reset",count:this.dbMap.size,model:this})}}});function Z(e){ee(e.target.files),closeResultsIoModal(),$("form#form-signature-import").get(0).reset()}function ee(e){if(0!=e.length){var t=new FileReader,n=e[0];t.onloadend=function(e){e.target.readyState==FileReader.DONE&&($("#loading-sub-text").html("This dialog will disappear once data is ready"),showLoading(),setTimeout(ie,10,e.target.result))},t.readAsText(n)}}function te(e){ee(e.dataTransfer.files),closeResultsIoModal()}function ne(e){e.preventDefault(),e.stopPropagation()}function re(e){dropArea.classList.add("highlight")}function ae(e){dropArea.classList.remove("highlight")}function ie(e){if(null===e)return;if(/[\x00-\x08\x0E-\x1F]/.test(e))return alert("Seems like the file you've selected is not textual. Please select a different file."),void hideLoading();const t=Papa.parse(e);let n=t.data.length,r=0,a=0,i=0,s=[];if(2==n&&("string"==typeof t.data[1]?0==t.data[1].trim().length&&(n=1):0==t.data[1][0].trim().length&&(n=1)),n>1){let e=t.data[0].findIndex((e=>"signature"===e.toLowerCase()));-1!=e&&(r=1,a=e),i=t.data.length;for(var o=r;o<i;o++)t.data[o][a]&&0!=t.data[o][a].trim().length&&s.push(t.data[o][a].trim())}else{i=t.data[0].length;for(o=0;o<i;o++)t.data[0][o]&&0!=t.data[0][o].trim().length&&s.push(t.data[0][o].trim())}s=s.join("|");var l={condition:"OR",rules:[{id:"signature_text",field:"signature_text",type:"string",input:"text",operator:"in_separated_list",value:s,ignoreCase:!1}],not:!1};$(`#${inpQueryBuilder}`).queryBuilder("setRules",l,!0),hideLoading(),document.getElementById("btnSearch").click()}var se=Object.freeze({__proto__:null,initDragAndDrop:function(){const e=document.getElementById("drop-area");["dragenter","dragover","dragleave","drop"].forEach((t=>{e.addEventListener(t,ne,!1)})),["dragenter","dragover"].forEach((t=>{e.addEventListener(t,re,!1)})),["dragleave","drop"].forEach((t=>{e.addEventListener(t,ae,!1)})),e.addEventListener("drop",te,!1),document.getElementById("fileElem").addEventListener("change",Z,!1)}});Object.assign(window,v,E,O,z,K,X,se)}();
//# sourceMappingURL=index.min.js.map
